<!DOCTYPE html>
<html data-bs-theme="light" lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Plex Mining - Bitcoin mining dashboard mit PV-Integration und Wetterprognose">
    <title>Plex Mining</title>
    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="res/style.css">
</head>
<body>
    <header>
        <img src="res/plexmining2.jpg" alt="Plex Mining Logo" loading="eager">
        <h1>Plex Mining <span>0.6.1</span></h1>
    </header>

    <main class="container">
        <section class="row">
            <div class="col-md-4">
                <div class="card same-height">
                    <div class="card-body">
                        <h5 class="card-title">Batteriestand <small class="text-muted float-end" id="ts-pv"></small></h5>
                        <div class="text-center mb-3">
                            <div id="battery-donut" style="width: 150px; height: 150px; margin: 0 auto;"></div>
                            <div class="mt-2">
                                <small class="text-muted"><span id="batterie-current"></span> kWh</small><br>
                                <small class="text-muted">> <span id="mining-min-battery"></span> kWh</small><br>
                                <small class="text-muted">Für Mining verfügbar: <span id="mining-status"></span></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card same-height">
                    <div class="card-body">
                        <h5 class="card-title">PV-Leistung</h5>
                        <div class="text-center mb-3">
                            <div id="solar-panel" style="width: 150px; height: 120px; margin: 0 auto;"></div>
                            <div class="mt-2">
                                <span id="pv-leistung" class="h5 text-primary"></span>
                            </div>
                            <div class="mt-1">
                                <small class="text-muted">Max: <span id="pv-kwp"></span> kWp</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card same-height">
                    <div class="card-body">
                        <h5 class="card-title">Steuerung</h5>
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="auto-mode-toggle">
                                <label class="form-check-label" for="auto-mode-toggle">Auto-Mode aktiviert</label>
                            </div>
                        </div>
                        <div class="mb-3" id="auto-mode-settings" style="display: none;">
                            <label for="system-scale" class="form-label">System-Skalierung (%):</label>
                            <input type="range" class="form-range" id="system-scale" min="0" max="100" value="100">
                            <div class="input-group mt-2">
                                <input type="number" class="form-control" id="system-scale-input" min="0" max="100" value="100">
                                <span class="input-group-text">%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="row">
            <div class="col-md-6">
                <div class="card same-height">
                    <div class="card-body">
                        <h5 class="card-title">14 Tage Wetter & Prognose <small class="text-muted float-end" id="ts-weather"></small></h5>
                        <div class="d-flex">
                            <div class="flex-grow-1">
                                <div class="table-responsive">
                                    <table class="table table-sm mb-2" style="max-width: 520px;">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th>Heute</th>
                                                <th>Morgen</th>
                                                <th>7 Tage</th>
                                                <th>14 Tage</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <th class="text-muted">Sonnenstunden (h)</th>
                                                <td id="sun-today"></td>
                                                <td id="sun-tomorrow"></td>
                                                <td id="sun-7d"></td>
                                                <td id="sun-14d"></td>
                                            </tr>
                                            <tr>
                                                <th class="text-muted">Strahlung (Wh/m²)</th>
                                                <td id="rad-today"></td>
                                                <td id="rad-tomorrow"></td>
                                                <td id="rad-7d"></td>
                                                <td id="rad-14d"></td>
                                            </tr>
                                                <tr>
                                                    <th class="text-muted">PV-Ertrag (kWh)</th>
                                                    <td id="pv-today"></td>
                                                    <td id="pv-tomorrow"></td>
                                                    <td id="pv-7d"></td>
                                                    <td id="pv-14d"></td>
                                                </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div id="weather-chart" class="my-3" style="width: 100%; height: 260px; min-width: 0;"></div>
                                <div class="accordion" id="weatherAccordion">
                                  <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingWeatherTable">
                                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWeatherTable" aria-expanded="false" aria-controls="collapseWeatherTable">
                                        Tabelle anzeigen
                                      </button>
                                    </h2>
                                    <div id="collapseWeatherTable" class="accordion-collapse collapse" aria-labelledby="headingWeatherTable" data-bs-parent="#weatherAccordion">
                                      <div class="accordion-body">
                                        <div class="table-responsive">
                                          <table class="table table-sm" id="weather-table">
                                            <thead>
                                              <tr>
                                                <th scope="col">Datum</th>
                                                <th scope="col">Sonnenstunden</th>
                                                <th scope="col">Strahlung (Wh/m²)</th>
                                                <th scope="col">PV-Ertrag (kWh)</th>
                                              </tr>
                                            </thead>
                                            <tbody id="weather-table-body"></tbody>
                                          </table>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </section>

        <!-- Stündliche Wetter-Sektion -->
        <section class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">24h Wetter & Prognose <small class="text-muted float-end" id="ts-weather-hourly"></small></h5>
                        <div class="row">
                            <div class="col-12">
                                <div id="weather-hourly-chart" style="width: 100%; height: 300px;"></div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="accordion" id="weatherHourlyAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#weatherHourlyTable" aria-expanded="false" aria-controls="weatherHourlyTable">
                                                Stündliche Details anzeigen
                                            </button>
                                        </h2>
                                        <div id="weatherHourlyTable" class="accordion-collapse collapse" data-bs-parent="#weatherHourlyAccordion">
                                            <div class="accordion-body">
                                                <div class="table-responsive">
                                                    <table class="table table-sm" id="weather-hourly-table">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col">Zeit</th>
                                                                <th scope="col">Sonnenstunden</th>
                                                             <th scope="col">Strahlung (W/m²)</th>
                                                             <th scope="col">Direktstrahlung (W/m²)</th>
                                                                <th scope="col">Bewölkung (%)</th>
                                                                <th scope="col">PV-Ertrag (kWh)</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="weather-hourly-table-body"></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="card-title mb-0">Miner</h5>
                            <div class="d-flex align-items-center">
                                <button type="button" class="btn btn-danger btn-sm me-3" id="emergency-stop">
                                    <i class="bi bi-exclamation-triangle-fill me-1"></i>NOT-AUS
                                </button>
                                <small class="text-muted" id="ts-miners"></small>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="miner-table">
                                <thead class="table-dark">
                                    <tr>
                                        <th scope="col">Miner ID</th>
                                        <th scope="col">Modell</th>
                                        <th scope="col">Max. Hashrate (TH/s)</th>
                                        <th scope="col">Max. Stromaufnahme (W)</th>
                                        <th scope="col">IP-Adresse</th>
                                    </tr>
                                </thead>
                                <tbody id="miner-table-body">
                                    <!-- Dynamic content will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>


    <script src="lib/bootstrap/js/bootstrap.bundle.min.js" defer></script>
    <script src="lib/d3/d3.v7.min.js" defer></script>
    <script src="res/helper.js" defer></script>
    <script src="res/graphs.js" defer></script>
    <script src="res/script.js" defer></script>
    <footer class="footer mt-auto py-3 bg-light">
      <div class="container">
        <span class="text-muted">© 2025 Alexander Thurn | <a href="https://github.com/alexanderthurn/plexmining">GitHub Repository</a></span>
      </div>
    </footer>
</body>
</html>